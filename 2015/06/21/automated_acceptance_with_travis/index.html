<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Automated acceptance with Travis</title> <meta name="description" content="When it comes to maintain or extend an existing mobile application, there is one thing you want toensure at any price: your changes should not break the exis..."> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="http://ktorz.github.io/2015/06/21/automated_acceptance_with_travis/"> <link rel="alternate" type="application/rss+xml" title="KtorZ's Blog" href="http://ktorz.github.io/feed.xml"> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="alternate" type="application/atom+xml" title="" href="http://ktorz.github.io/feed.xml" /> <script src="/assets/js/modernizr.js"></script> <!-- Google Analytics --> </head> <body"> <main class="wrapper"> <header class="site-header"> <a href="#navbar" id="menu-burger" class="menu-burger">Menu <span class="nav-icon"></span> <svg x="0px" y="0px" width="54px" height="54px" viewBox="0 0 54 54"> <circle fill="transparent" stroke="#000000" stroke-width="1" cx="27" cy="27" r="25" stroke-dasharray="157 157" stroke-dashoffset="157"></circle> </svg> </a> <div id="navbar" class="navbar"> <div class="navigation-wrapper"> <div class="half-block"> <h2>Navigation</h2> <nav> <ul class="primary-nav"> <li><a href="/">Blog</a></li> <li><a href="/references">References</a></li> <li><a href="/about">About</a></li> <li><a href="http://github.com/KtorZ" target="_blank"><i class="icon icon-github"></i> Github</a></li> <li><a href="http://linkedin.com/in/matthias-benkort-47186a57" target="_blank"><i class="icon icon-linkedin"></i> LinkedIn</a></li> <li><a href="/feed.xml" target="_blank"><i class="icon icon-feed"></i> RSS</a></li> </ul> </nav> </div> </div> </div> </header> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header intro"> <div class="intro-in"> <h1 class="post-title" itemprop="name headline">Automated acceptance with Travis</h1> <p class="post-meta"><time datetime="2015-06-21T11:40:02+02:00" itemprop="datePublished">Jun 21, 2015</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Matthias Benkort</span></span></p> </div> </header> <div class="post-content container" itemprop="articleBody"> <p>When it comes to maintain or extend an existing mobile application, there is one thing you want to ensure at any price: your changes should not break the existing working product. In other words, you should avoid any kind of regression. This is what <strong>automated acceptance</strong> stands for.</p> <!--more--> <h2 id="test-things-before-its-too-late">Test things before it’s too late</h2> <p>Nowadays and especially with framework like <strong>Titanium</strong>, you can build an app really quickly - Even making a coffee might be longer. However, as an app grows and becomes larger and larger, a non-structured project might evolve into a complete mess where each new feature brings an additional bug. Writing tests for an app, before everything goes out of control might be one of the prior concern of a developer.</p> <p>Testing things is a well-known and experienced field of the computer sciences; Fortunately for us, a lot of testing solutions exist for the mobile development, and especially in the <strong>Titanium</strong>’s world.</p> <p>I’ll not present existing testing solution here (<em>Jasmine</em>, <em>Mocha</em>, <em>Calabash</em> and <em>Cucumber</em> …); This is likely to be the subject of a further topic. Nevertheless, whatever testing solution you have adopted, being able to run tests automatically and generate reports for you about how it went is an interesting feature.</p> <p><a href="https://travis-ci.org/"><strong>Travis</strong></a> is an easy way to accomplish such a thing. It is probably the most used automated acceptance tool alongside <strong>GitHub</strong>. It performs automatic builds and test runs after every push on a given <strong>GitHub</strong> repository. Let’s see how we can setup <strong>Travis</strong> for our <strong>Titanium</strong> applications.</p> <h2 id="how-to-setup-an-automated-acceptance-process">How to setup an automated acceptance process</h2> <p>After linking your <strong>GitHub</strong> account with <strong>Travis</strong>, the only thing required to make <strong>Travis</strong> works is a configuration <em>YML</em> file, placed at your repository’s root. Right below is an example of a travis file we used for our application.</p> <figure class="highlight"><pre><code class="language-xml" data-lang="xml">.travis.yml

    language: objective-c 

    env:
        matrix:
            - PLATFORM=&quot;ios&quot;
            - PLATFORM=&quot;android&quot; ANDROID_VERSION=&quot;19&quot;

    before_install:
        - export ANDROID_HOME=$PWD/android-sdk-macosx
        - export ANDROID_SDK=$ANDROID_HOME
        - export PATH=${PATH}:${ANDROID_HOME}/tools:${ANDROID_HOME}/platform-tools

    install:
        - npm install -g titanium alloy tishadow gulp ticalabash
        - npm install

        - titanium login travisci@appcelerator.com travisci
        - titanium sdk install latest --no-progress-bars

        - gulp &#39;install:android_sdk&#39;

    before_script:
        - gulp &#39;start:emulator&#39;
        - gulp &#39;config:tiapp&#39; --test

    script: 
        - gulp &#39;test:calabash&#39;
        - gulp &#39;test:jasmine&#39;</code></pre></figure> <p>This configuration allow us to create two jobs on <strong>Travis</strong>, one for <em>Android</em> and the other one for <em>iOS</em>. A job is a set of tasks that are executed in a completly new virtual machine (VM). Incidentally, each machine in <strong>Travis</strong> comes with a set of existing tools like <em>rvm</em> or <em>npm</em>. Let’s dissect a bit that configuration file to understand what’s going on.</p> <h3 id="prepare-the-environment">Prepare the environment</h3> <p>As we will need to build for <em>iOS</em>, we need to start a VM that runs on <em>Mac OS</em>. This could be done by telling <strong>Travis</strong> to use <code>objective-c</code> as a language.</p> <figure class="highlight"><pre><code class="language-xml" data-lang="xml">...
    language: objective-c
...</code></pre></figure> <p>Also, it is possible to create separate jobs by defining a <code>matrix</code> of environment variables. Under the hood, <code>matrix</code> definition in <strong>Travis</strong> are really powerful (a way more powerful that we are currently doing). The next lines tell <strong>Travis</strong> to create two jobs for which the given environment variables will be available. Then, we are gonna use those variables in several scripts, but it does not make any sense for <strong>Travis</strong> itself. By the by, <strong>Travis</strong> configuration files could be split into several sections (<code>before_install</code>, <code>install</code>, <code>before_script</code>, <code>script</code>, <code>before_deploy</code>, <code>deploy</code>, <code>after_success</code> …) Those sections have different meanings and for most of them it doesn’t change a thing to your build process. This is rather a semantic consideration. If something goes wrong in the sections <code>before_install</code>, <code>install</code> or <code>before_script</code>, your build will be considered as <em>errored</em>. If something goes wrong in the <code>script</code> section, it will rather be considered as <em>failed</em>.</p> <p>As a matter of fact, those sections might be used to perform bash commands. A common thing to do is to call some scripts or tasks runner commands to perform a more complex action.</p> <figure class="highlight"><pre><code class="language-xml" data-lang="xml">...
    env:
        matrix:
            - PLATFORM=&quot;ios&quot;
            - PLATFORM=&quot;android&quot; ANDROID_VERSION=&quot;19&quot;

    before_install:
        - export ANDROID_HOME=$PWD/android-sdk-macosx
        - export ANDROID_SDK=$ANDROID_HOME
        - export PATH=${PATH}:${ANDROID_HOME}/tools:${ANDROID_HOME}/platform-tools
... </code></pre></figure> <h3 id="set-up-titanium-and-your-test-environment">Set up Titanium and your test environment</h3> <p>To be able to build a <strong>Titanium</strong> app, it has to be installed on the VM, obviously. Fortunatly, the node package manager is accessible and then, all the installation could be done the following way:</p> <figure class="highlight"><pre><code class="language-xml" data-lang="xml">...
    install:
        - npm install -g titanium alloy tishadow gulp ticalabash
        - npm install

        - titanium login travisci@appcelerator.com travisci
        - titanium sdk install latest --no-progress-bars

        - gulp &#39;install:android_sdk&#39;
...</code></pre></figure> <p>In order to use the <strong>Titanium</strong> cli, it is also required to login. As you don’t want to put your credentials on a public repository, you can just use those available for that purpose!</p> <p>Moreover, in our case, we are also installing some other tools with <strong>Titanium</strong>. Notably <strong>Gulp</strong> which is a <em>JavaScript</em> task runner that will handle builds and tests. You may find interesting tasks in our <em>boilerplate</em> project right <a href="https://github.com/TheSmiths/ts.boilerplate/tree/master/project_files/.gulp">here</a>. Most of them could easily be written using another task runner (such as <em>Grunt</em> or <em>Rake</em>) or simply written in some bash scripts. I’ll not dive into those tasks as they have been written to fit our needs, and as I said, it will be the topic of another blog post.</p> <h2 id="watch-your-results">Watch your results</h2> <p>With your <code>.travis.yml</code> configuration file set up, <strong>Travis</strong> will be able to set up jobs for every push you perform on <strong>GitHub</strong>. It also gives you any output to the console of any executed command. Then, it’s up to you to look at those results and pieces of information; You can also configure <strong>Travis</strong> to send you an email after a build to tell you about the results.</p> <p>Also, it is nice to put the information directly on <strong>GitHub</strong> using a small badge <img src="https://api.travis-ci.org/TheSmiths-Widgets/ts.blurryview.svg" alt="Travis" />. In that way, other developers might know that what they are looking at is something that compiles and pass some tests!</p> </div> </article> <footer class="site-footer"> <div class="container"> <ul class="social"> <li><a href="http://github.com/KtorZ" target="_blank"><i class="icon icon-github"></i></a></li> <li><a href="http://linkedin.com/in/matthias-benkort-47186a57" target="_blank"><i class="icon icon-linkedin"></i></a></li> <li><a href="http://twitter.com/mbenkort" target="_blank"><i class="icon icon-twitter"></i></a></li> </ul> <p> <small>&copy;2016 All rights reserved. Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and ♥</small> </p> </div> </footer> </main> <script src="/assets/js/jquery-2.1.1.js"></script> <script src="/assets/js/main.js"></script> </body> </html><!-- by nandomoreira.me -->